<toaster-container></toaster-container>
<div class="row wrapper border-bottom white-bg page-heading">
	<div class="col-lg-9">
    <h2>Pólizas</h2>
    <ol class="breadcrumb margin-top-15">
      <li ng-if="!show_contractor">
        <a ui-sref="inicio.inicio">Inicio</a>
      </li>
      <li class="active" ng-show="!show_contractor">
        <strong>Pólizas</strong>
      </li>
      <li class="active" ng-show="show_contractor" ng-click="returnToPolicy()">
        <a>Regresar</a>
      </li>
    </ol>
  </div>
</div>
<!-- <button ng-click="show_contractor = false">TEST</button> -->
<div ng-if="show_contractor" class="animate z-index-9000">
  <div>
    <ng-include src="'app/contratantes/contratantes.add.html'" ng-controller="ContratantesCtrl as vm"></ng-include>
  </div>
</div>

<div class="wrapper wrapper-content animated fadeIn ng-scope" ng-if="!show_contractor" class="animate">
  <div class="row">
    <div class="col-lg-12"></div>
  </div>

  <div class="row">
    <div class="col-lg-12">
      <div class="ibox float-e-margins">
        <div class="ibox-content wizard">
          <uib-tabset active="activeJustified" justified="true">
            <uib-tab index="0" heading="OT" ng-click="order.hideButtonOT()" ng-show="order.acceso_adm_ot">
              <div id="divCOT"  ng-include="'app/ordenes/ordenes.generic.html'"></div>
            </uib-tab>
            <uib-tab index="1" heading="Póliza" ng-click="order.showButtonPoliza()" ng-show="order.acceso_adm_pol">
              <div  id="divCPoliza"  ng-include="'app/ordenes/ordenes.generic.html'"></div>
            </uib-tab>
          </uib-tabset>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div ng-if="activeJustified == 0">
      <div class="form-group">
        <div class="col-xs-12">
          <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 form-group pull-right" ng-if="order.acceso_adm_ot">
            <button class="col-xs-12 btn btn-primary ladda-button" ng-click="validatePolicy('ot')" data-style="expand-right"><span class="ladda-label">Crear OT</span></button>
            <button class="col-xs-12 btn btn-primary" ng-if="order.acceso_adm_pol" ng-click="order.save.saveInsurance('poliza')" ng-disabled="order.options.showPoliceCreator()" ng-show="!order.show.ot" type="button">Crear Póliza</button>
          </div>
          <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 form-group pull-right">
            <button id="closeOT" class="col-xs-12 btn btn-danger" ng-click="order.save.closeModal()" type="button">Cancelar</button>
          </div>
          <!-- <button class="btn btn-success" ng-click="order.save.saveInsurance('ot')" ng-disabled="order.form.contratante.length === 0" ng-show="order.show.ot" type="button">Crear OT</button> -->
        </div>
      </div>
    </div> 
    <div ng-if="activeJustified == 1 && order.acceso_adm_pol">
      <div class="form-group">
        <div class="row"> 
            <div class="col-xs-12 form-group container-loader" ng-if="enproceso">
              <!-- <img src="../../assets/images/loader/black_loader.gif"> -->
            </div>
        </div>
        <div
          ng-class="{
              'alert alert-success alertpdf': serieAGuardar && serieDetectada === serieAGuardar,
              'alert alert-danger alertpdf': serieAGuardar && serieDetectada !== serieAGuardar,
              'alert alert-warning alertpdf': !serieAGuardar
          }" 
          style="padding: 12px 15px;"
          ng-if="order.form.subramo && order.form.subramo.subramo_code==9 && mostrarAdvertenciaSerie">
          <span><h3>CAPTURA DE LA SERIE EN EL PDF</h3></span>
          <img ng-if="imgSerieSrc" ng-src="{{imgSerieSrc}}" style="max-width:100%;" />
          <div ng-if="order.subforms.auto.serial"
              style="display:flex; gap:12px; align-items:flex-start; padding:14px 16px; border:1px solid #cfe2ff; background:#f8fbff; border-radius:12px; margin:12px 0;">
            <div style="width:34px; height:34px; border-radius:10px; background:#1976d2; color:#fff; display:flex; align-items:center; justify-content:center; font-weight:900;">
              VIN
            </div>            
            <div style="flex:1;">
              <div style="font-size:12px; font-weight:700; color:#1e3a8a;">
                <h3>SERIE DETECTADA POR SAAM</h3>
                A guardar
                <div
                  style="font-size:22px; font-weight:800; margin-top:4px; word-break:break-all; display:flex; align-items:center; gap:8px;"
                  ng-class="{
                    'vin-ok': !hasInvalidVinLettersTest(order.subforms.auto.serial),
                    'vin-warning': hasInvalidVinLettersTest(order.subforms.auto.serial)
                  }">
                  {{ order.subforms.auto.serial || '—' }}
                  <!-- Badge discreto -->
                  <span
                    ng-if="hasInvalidVinLettersTest(order.subforms.auto.serial)"
                    style="
                      font-size:11px;
                      font-weight:800;
                      padding:4px 8px;
                      border-radius:999px;
                      background:#fff1f2;
                      color:#991b1b;
                      border:1px solid #fecdd3;
                      white-space:nowrap;
                    "  title="El VIN contiene letras no permitidas (O, I, Q)">
                    <i class="fa fa-exclamation-triangle" style="margin-right:4px;"></i>
                    Serie inválida
                  </span>
                </div>
              </div>
            </div>
          </div>
          <p style="margin: 0 0 5px 0; font-size: 14px; color: #333;"
            ng-if="serieDetectada && order.form.subramo.subramo_code==9">
            <strong>⚠ Serie detectada en el documento:</strong> 
            <span style="font-weight: bold; color: #000;">{{serieDetectada}}</span>
          </p>

          <small style="display: block; margin-top: 6px; line-height: 1.5; font-size: 13px; color: #444;">
            <span>
              Por favor <strong>revise cuidadosamente</strong> que la <strong>SERIE</strong> detectada coincida exactamente con la que aparece en su documento original.
            </span>
            <br><br>
            <!-- <a href="" ng-click="omitirAdvertencia()" 
              style="font-weight: bold; color: #46a942; text-decoration: underline;" 
              class="pull-right">
              Omitir
            </a><br> -->
          </small>
        </div>

        <div class="col-xs-12"  ng-if="enproceso==false">
          <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 form-group pull-right">
            <!-- <button class="col-xs-12 btn btn-primary ladda-button" ng-click="order.save.saveInsurance('poliza')" ng-disabled="!order.form.poliza || !(order.form.contratante.email || order.form.contratante.phone_number)" data-style="expand-right"><span class="ladda-label">Guardar Póliza</span></button> -->
            <button class="col-xs-12 btn btn-primary ladda-button" ng-click="validatePolicy('poliza')" ng-if="order.acceso_adm_pol" ng-disabled="enproceso">Crear Póliza</button>
          </div>
          <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 form-group pull-right">
            <button class="col-xs-12 btn btn-danger" ng-click="order.save.closeModal()" type="button">Cancelar</button>
          </div>
          <!-- <button  ng-click="order.save.saveInsurance('poliza')" ng-disabled="!order.form.poliza" class="btn btn-success" type="button">Guardar póliza</button> -->
        </div>
      </div>
    </div>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>