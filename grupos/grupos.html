<toaster-container></toaster-container>
<div class="row wrapper border-bottom white-bg page-heading">
  <div class="col-lg-9">
    <h2>Grupos</h2>
    <ol class="breadcrumb margin-top-15">
      <li>
        <a ui-sref="inicio.inicio">Inicio</a>
      </li>
      <li class="active">
        <strong>Grupos</strong>
      </li>
    </ol>
  </div>
</div>

<div class="wrapper wrapper-content animated fadeIn ng-scope">
  <div class="row" ng-if="vm.acceso_adm_cont">
    <div class="col-lg-12">
      <div class="ibox float-e-margins collapsed">
        <div class="ibox-title" ng-if="vm.acceso_adm_cont">
          <h5>Agregar nuevo grupo</h5>
          <div ibox-tools></div>
        </div>
        <div class="ibox-content" >
          <div class="alert alert-danger" ng-show="vm.error">{{vm.error}}</div>
          <form method="post" name="form" ng-submit="vm.submit(form.$valid)" novalidate role="form">
            <div class="form-group">
              <label>Nombre del Grupo<span class="color-red">*</span></label>
             <autocomplete datasource="vm.groups_results" id="autocompleteGroups" model="vm.form.group_name" change="vm.searchGroups(vm.form.group_name);vm.saveLocalstorage()"></autocomplete>
            </div>
            <div class="form-group">
              <label>Responsable<span class="color-red">*</span></label>
                <select class="form-control m-b" name="responsable" ng-model="vm.form.responsable" ng-change="changeResponsable(vm.form.responsable); vm.saveLocalstorage()" ng-options="responsable.url as responsable.first_name + ' ' + responsable.last_name for responsable in users track by responsable.url" >
                    <option value="" disabled>Seleccione un responsable</option>
                </select>
            </div>
            <div class="form-group">
              <label>Observaciones</label>
              <textarea class="form-control" name="description" ng-model="vm.form.description" type="text" ng-change="vm.saveLocalstorage()"></textarea>
            </div>
            <div class="col-xs-12 col-sm-6 col-md-3 form-group">
              <button class="col-xs-12 btn btn-success" ng-if="subgroups.length == 0" ng-click="addSubgroups();vm.saveLocalstorage()"><i class="fa fa-plus" aria-hidden="true"></i> Agregar Subgrupos</button>
            </div>
            <div class="address-container" ng-repeat="item in subgroups">
              <div class="col-xs-12 legend-gray">
                <legend class="legend-title legend-flex" align="center">
                  <button type="button" class="btn btn-danger pull-left hidden-xs" name="button" ng-click="deleteSubgroup($index);vm.saveLocalstorage()"
                    <i class="fa fa-minus-circle" aria-hidden="true"></i> Quitar Subgrupo
                  </button>
                  <button type="button" class="btn btn-danger pull-left visible-xs-inline-block" name="button" ng-click="deleteSubgroup($index);vm.saveLocalstorage()">
                    <i class="fa fa-minus-circle" aria-hidden="true"></i>
                  </button>
                  <span class="hidden-xs"> Subgrupo #{{$index + 1}}
                  </span>
                  <button class="btn btn-success pull-right hidden-xs" ng-click="addSubgroups();vm.saveLocalstorage()" type="button">
                    <i class="fa fa-plus-circle" aria-hidden="true"></i> Agregar Subgrupo
                  </button>
                  <button class="btn btn-success pull-right visible-xs-inline-block" ng-click="addSubgroups();vm.saveLocalstorage()" type="button">
                    <i class="fa fa-plus-circle" aria-hidden="true"></i>>
                  </button>
                </legend>
              </div>
              <div class="col-xs-12 address_components">
                <div class="col-xs-12 col-sm-6 form-group">
                  <label>Nombre: <span class="color-red">*</span></label>
                  <input class="form-control" type="text" ng-model="item.group_name" ng-change="vm.saveLocalstorage()">
                </div>

                <div class="col-xs-12 col-sm-6 form-group">
                  <label>Nombre del Subsubgrupo:</label>
                  <input class="form-control" type="text" ng-model="item.sub_subgroup[0].group_name" ng-change="vm.saveLocalstorage()">
                </div>
              </div>
            </div>
            <div class="hr-line-dashed"></div>
            <div class="row">
              <div class="col-sm-12">
                <legend class="legend-title" align="center">Contactos</legend>
                <div class="table-responsive">
                  <table class="table table-striped table-bordered table-hover table table-stripped" data-page-size="25">
                    <thead>
                      <tr>
                        <th class="footable-visible footable-sortable footable-first-column" data-breakpoints="xs">
                          Nombre
                        </th>
                        <th class="footable-visible footable-sortable" data-hide="phone">
                          Teléfono
                        </th>
                        <th data-hide="phone" class="footable-sortable">
                          Correo electrónico
                        </th>
                        <th data-hide="phone" class="footable-sortable">
                          Departamento
                        </th>
                        <th data-hide="phone" class="footable-sortable">
                          Opción
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr ng-repeat="contact in vm.form.contact_group track by $index" foo-repeat-done>
                        <td><input class="form-control" type="text" ng-model="contact.name" ng-change="vm.saveLocalstorage()" style="text-transform: capitalize"></td>
                        <td>
                          <!-- <input class="form-control" type="text" ng-model="contact.phone_number"  id="phoneNGroup" international-phone-number default-country="mx" auto-hide-dial-code="true" allow-extensions="true" auto-placeholder="false" preferred-countries only-countries="mx, us"> -->
                          <phonenumber-directive model="contact.phone_number" class="ng-isolate-scope">
            								<input ng-model="inputValue" ng-change="vm.saveLocalstorage()" type="tel" class="phonenumber form-control ng-pristine ng-valid ng-valid-maxlength ng-touched" maxlength="25"
            											placeholder="" title="Phonenumber (Format: (999) 9999-9999)" aria-invalid="false" style="" >
            							</phonenumber-directive>
                        </td>
                        <td><input class="form-control" ng-model="contact.email" ng-change="vm.saveLocalstorage()"></td>
                        <td><input class="form-control" type="text" ng-model="contact.departament" ng-change="vm.saveLocalstorage()"></td>
                        <td>
                            <button type="button" class="btn btn-w-m btn-danger" name="button"  ng-click="vm.deleteContacts($index); vm.saveLocalstorage()" ng-if="vm.user.permiso.crear">Eliminar</button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <div class="col-sm-12">
                    <button class="btn btn-success pull-right" ng-click="vm.addContact();vm.saveLocalstorage()" type="button">Agregar contacto</button>
                </div>
              </div>
            </div>
            <div class="hr-line-dashed"></div>
            <div upload-template></div>
            <div ng-include="'templates/show-files.html'"></div>
            <div class="hr-line-dashed"></div>
            <div class="row">
              <div class="form-group col-xs-12 col-sm-6 col-md-3 pull-right">
                <button class="btn btn-primary col-xs-12" ng-disabled="form.$invalid" type="submit"><i class="fa fa-save" aria-hidden="true"></i> Crear Grupo</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <div class="row" ng-if="vm.acceso_ver_cont">
    <div class="col-xs-12 form-group">
      <label>Nombre del Grupo</label>
      <div class="col-xs-12 input-group">
        <input type="text" class="form-control" id="filter" placeholder="Buscar" ng-enter="vm.search(cadena)" ng-model="cadena" ng-change="vm.saveLocalstorage()">
        <div class="input-group-btn">
          <button class="btn btn-success" ng-click="vm.activate()">Mostrar todos</button>
        </div>
      </div>
    </div>
    <div class="col-xs-12 form-group" ng-if="vm.groups.length">
      <table class="table table-bordered table-hover table-stripped" data-filter="#filter" data-page-size="25" ng-if="!vm.show_binnacle">
        <thead>
          <tr>
            <th class="footable-visible footable-sortable footable-first-column" data-breakpoints="xs" >
              Grupo
              <span class="footable-sort-indicator"></span>
            </th>
            <th class="footable-visible footable-sortable footable-first-column" data-breakpoints="xs" >
              Responsable
              <span class="footable-sort-indicator"></span>
            </th>
            <th class="footable-visible footable-sortable" data-hide="phone">
              Descripción
              <span class="footable-sort-indicator"></span>
            </th>
            <th data-hide="phone" class="footable-sortable">
              Acciones
            </th>
          </tr>
        </thead>
        <tbody>
          <tr ui-sref="grupos.info({grupoId: group.id})" ng-repeat="group in vm.groups track by $index">
            <td>{{ group.group_name }}</td>
            <td ng-if="group.responsable">{{ group.responsable.first_name }} {{ group.responsable.last_name }}</td>
            <td ng-if="!group.responsable">Sin responsable asignado</td>
            <td>{{ group.description }}</td>
            <td ng-click="$event.stopPropagation()">
              <a ng-click="vm.editGroup(group)" ui-sref="grupos.edit({grupoId: group.id})" type="button" class="btn btn-info" ng-if="vm.user.permiso.editar"><i class="fa fa-pencil" aria-hidden="true"></i></a>
              <a class="btn btn-white btn-sm" ng-click="$event.stopPropagation(); vm.showBinnacle(group)"><i class="fa fa-comment" aria-hidden="true"></i></a>
            </td>
          </tr>
        </tbody>
      </table>
      <div ng-if="show_pagination && !vm.show_binnacle" class="text-center">
        <pagination config="vm.config_pagination" model="vm.groups"></pagination>
      </div>
    </div>
    <div class="col-xs-12 col-sm-6 col-md-3 form-group" ng-if="vm.groups.length && vm.buttonReport == false && !vm.show_binnacle">
      <button ng-click="exportData('Grupos')" class="col-xs-12 btn btn-primary"><i class="fa fa-download" aria-hidden="true"></i> Generar Reporte</button>
    </div>
  </div>
</div>
